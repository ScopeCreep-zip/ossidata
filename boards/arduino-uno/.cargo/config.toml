[build]
target = "avr-none"
rustflags = ["-C", "target-cpu=atmega328p"]

[target.'cfg(target_arch = "avr")']
# Use external terminal flash system to prevent Claude Code hanging
# This calls our cross-platform flash.sh which opens external terminal
runner = """sh -c '
  BINARY_NAME=$(basename "$1" .elf)
  PORT="${OSSIDATA_PORT:-/dev/cu.usbmodem14401}"
  HEX="${CARGO_TARGET_DIR:-../../target}/avr-none/release/$BINARY_NAME.hex"

  # Convert ELF to HEX (build is already done by cargo)
  avr-objcopy -O ihex "$1" "$HEX"

  # Call flash.sh which opens external terminal for flashing
  # This prevents Claude Code terminal from hanging
  exec ../../flash.sh "$PORT" "$BINARY_NAME"
' --"""

[unstable]
build-std = ["core"]