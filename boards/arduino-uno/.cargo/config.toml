[build]
target = "avr-none"
rustflags = ["-C", "target-cpu=atmega328p"]

[target.'cfg(target_arch = "avr")']
# Safe runner that won't hang - uses avrdude with proper flags
runner = """sh -c '
  PORT="${OSSIDATA_PORT:-/dev/cu.usbmodem14401}"
  HEX="${CARGO_TARGET_DIR:-../../target}/avr-none/release/$(basename "$1" .elf).hex"
  avr-objcopy -O ihex "$1" "$HEX"
  echo "Flashing to $PORT..."
  avrdude -p atmega328p -c arduino -P "$PORT" -b 115200 -s -qq -D -U flash:w:"$HEX":i 2>/dev/null
  echo "Flash complete!"
' --"""

[unstable]
build-std = ["core"]